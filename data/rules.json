[
  {
    "code": "RULE_001",
    "name": "Tank Volume vs. Filter Flow Rate",
    "description": "Warn when filter turnover is outside a typical planted tank range.",
    "severity": "warning",
    "categories_involved": ["tank", "filter"],
    "condition_logic": {
      "type": "turnover_range",
      "tank_volume_key": "volume_gal",
      "filter_flow_key": "flow_rate_gph",
      "min_turnover": 4,
      "max_turnover": 15
    },
    "message_template": "Most planted tanks do best with 4–10× turnover. Your filter provides {turnover}× turnover for this tank.",
    "fix_suggestion": "Choose a filter with adjustable flow, add a spray bar, or pick a model better sized for your tank.",
    "active": true,
    "version": 1
  },
  {
    "code": "RULE_002",
    "name": "Light PAR vs. Plant Light Demand",
    "description": "Warn when high-light plants are selected with low PAR.",
    "severity": "warning",
    "categories_involved": ["light", "plants"],
    "condition_logic": {
      "type": "plant_light_demand_min_par",
      "light_par_key": "par_at_substrate",
      "min_par_for_high": 50,
      "blocks_selection": true
    },
    "message_template": "High-light plants like {plant_name} typically need PAR > 50 µmol at substrate level. Your light provides approximately {par} µmol.",
    "fix_suggestion": "Upgrade your light or swap for lower-demand plants.",
    "active": true,
    "version": 1
  },
  {
    "code": "RULE_003",
    "name": "CO2 Requirement",
    "description": "Warn when CO2-required plants are selected without a CO2 system.",
    "severity": "warning",
    "categories_involved": ["plants", "co2"],
    "condition_logic": {
      "type": "co2_required_plants",
      "required_value": "required",
      "blocks_selection": true
    },
    "message_template": "Plants like {plant_name} require CO2 injection to thrive. Without CO2, expect slow growth or melting.",
    "fix_suggestion": "Add a CO2 system or swap for low-tech-friendly alternatives.",
    "active": true,
    "version": 1
  },
  {
    "code": "RULE_004",
    "name": "Light Fixture Length vs. Tank Length",
    "description": "Error when light length range does not fit the selected tank.",
    "severity": "error",
    "categories_involved": ["tank", "light"],
    "condition_logic": {
      "type": "light_fit_range",
      "tank_length_key": "length_in",
      "light_min_key": "min_tank_length_in",
      "light_max_key": "max_tank_length_in"
    },
    "message_template": "This light is designed for {light_range} tanks, but your tank is {tank_length} inches. It won't mount properly.",
    "fix_suggestion": "Choose a light sized for your tank length.",
    "active": true,
    "version": 1
  },
  {
    "code": "RULE_005",
    "name": "Substrate Buffering + pH Sensitivity",
    "description": "Recommend caution when active substrate lowers pH and plants prefer alkaline water.",
    "severity": "recommendation",
    "categories_involved": ["substrate", "plants"],
    "condition_logic": {
      "type": "substrate_buffers_ph",
      "substrate_key": "buffers_ph",
      "plant_ph_min_threshold": 7.0
    },
    "message_template": "Active substrates like {substrate_name} lower pH. Plants preferring alkaline water ({plant_name}) may not do their best.",
    "fix_suggestion": "Consider an inert substrate or plants tolerant of lower pH.",
    "active": true,
    "version": 1
  },
  {
    "code": "RULE_006",
    "name": "Heater Wattage Sizing",
    "description": "Warn when heater wattage is outside typical watts-per-gallon sizing.",
    "severity": "warning",
    "categories_involved": ["tank", "heater"],
    "condition_logic": {
      "type": "heater_watts_per_gallon",
      "tank_volume_key": "volume_gal",
      "heater_wattage_key": "wattage",
      "min_wpg": 3,
      "max_wpg": 7
    },
    "message_template": "The general rule is 3–5 watts per gallon. Your heater provides {wpg} watts per gallon for this tank.",
    "fix_suggestion": "Choose a heater better sized for your tank volume.",
    "active": true,
    "version": 1
  },
  {
    "code": "RULE_007",
    "name": "Shrimp-Safe Fertilizer Check",
    "description": "Error when shrimp flag is enabled and fertilizer contains copper.",
    "severity": "error",
    "categories_involved": ["fertilizer", "accessories"],
    "condition_logic": {
      "type": "shrimp_copper_check",
      "requires_shrimp_flag": true
    },
    "message_template": "This fertilizer contains copper, which can be toxic to invertebrates. Choose a shrimp-safe alternative.",
    "fix_suggestion": "Pick a fertilizer explicitly marked shrimp-safe.",
    "active": true,
    "version": 1
  },
  {
    "code": "RULE_008",
    "name": "Carpet Plant + Light/CO2",
    "description": "Recommend caution when carpet plants are selected without high light and CO2.",
    "severity": "recommendation",
    "categories_involved": ["plants", "light"],
    "condition_logic": {
      "type": "carpet_needs_light_and_co2",
      "carpet_value": "carpet",
      "min_par": 80,
      "blocks_selection": true
    },
    "message_template": "Carpet plants like {plant_name} almost always need high light AND CO2 to carpet successfully.",
    "fix_suggestion": "Add CO2 and a higher-output light, or choose a non-carpeting foreground plant.",
    "active": true,
    "version": 1
  },
  {
    "code": "RULE_009",
    "name": "Stand Weight Capacity",
    "description": "Error when filled tank weight exceeds stand rating.",
    "severity": "error",
    "categories_involved": ["tank", "stand"],
    "condition_logic": {
      "type": "stand_weight_capacity",
      "tank_weight_key": "filled_weight_lbs",
      "stand_capacity_key": "weight_capacity_lbs"
    },
    "message_template": "This tank weighs approximately {weight} lbs when filled. This stand is rated for {capacity} lbs. This is a safety hazard.",
    "fix_suggestion": "Choose a stand rated for the filled weight of your tank.",
    "active": true,
    "version": 1
  },
  {
    "code": "RULE_010",
    "name": "Hardscape pH/GH Impact",
    "description": "Recommend caution when hardscape raises GH/KH and plants prefer soft water.",
    "severity": "recommendation",
    "categories_involved": ["hardscape", "plants"],
    "condition_logic": {
      "type": "hardscape_raises_hardness",
      "hardscape_key": "raises_gh",
      "plant_soft_water_key": "prefers_soft_water"
    },
    "message_template": "Seiryu stone raises GH and KH over time. Soft-water plants like {plant_name} may grow more slowly.",
    "fix_suggestion": "Consider using inert stone or adjusting your water change routine.",
    "active": true,
    "version": 1
  },
  {
    "code": "RULE_011",
    "name": "Planting Density",
    "description": "Recommend adding more plant mass for stability and algae prevention.",
    "severity": "recommendation",
    "categories_involved": ["tank", "plants"],
    "condition_logic": {
      "type": "planting_density_min_species",
      "tank_volume_key": "volume_gal",
      "min_tank_volume_gal": 10,
      "min_species_count": 3
    },
    "message_template": "Lightly planted tanks are more prone to algae. You have {plant_count} plant(s) in a {tank_volume} gallon tank. Consider adding more plant mass.",
    "fix_suggestion": "Add 3–5 more easy species (stems, floaters, fast growers) to stabilize the tank early.",
    "active": true,
    "version": 1
  },
  {
    "code": "RULE_012",
    "name": "Inline CO2 Diffuser + Canister Filter",
    "description": "Positive recommendation for an effective CO2 setup when applicable.",
    "severity": "recommendation",
    "categories_involved": ["co2", "filter"],
    "condition_logic": {
      "type": "co2_inline_diffuser_with_canister",
      "filter_type_key": "type",
      "filter_type_value": "canister",
      "co2_diffuser_type_key": "diffuser_type",
      "co2_diffuser_type_value": "inline"
    },
    "message_template": "Inline diffusers paired with canister filters can give excellent CO2 dissolution. Make sure tubing diameters match.",
    "fix_suggestion": "Verify your filter hose diameter and choose an inline diffuser/reactor sized for it.",
    "active": true,
    "version": 1
  },
  {
    "code": "RULE_013",
    "name": "Nano Tank + Canister Filter",
    "description": "Warn when a tiny tank uses a canister filter category/type.",
    "severity": "warning",
    "categories_involved": ["tank", "filter"],
    "condition_logic": {
      "type": "nano_tank_filter_type_warning",
      "tank_volume_key": "volume_gal",
      "max_tank_volume_gal": 5,
      "filter_type_key": "type",
      "filter_type_value": "canister"
    },
    "message_template": "Canister filters can be overkill for nano tanks. Consider a small sponge filter or a gentle HOB instead.",
    "fix_suggestion": "Pick a nano-appropriate filter with adjustable flow and easy maintenance.",
    "active": true,
    "version": 1
  },
  {
    "code": "RULE_014",
    "name": "Temperature Range Mismatch",
    "description": "Warn when selected plants have non-overlapping temperature ranges.",
    "severity": "warning",
    "categories_involved": ["plants"],
    "condition_logic": {
      "type": "plant_temperature_overlap",
      "temp_min_key": "tempMinF",
      "temp_max_key": "tempMaxF"
    },
    "message_template": "Temperature preferences for {plant_a} ({range_a}°F) and {plant_b} ({range_b}°F) don't overlap well. One or both may struggle.",
    "fix_suggestion": "Swap one of the plants or keep the tank temperature within the overlap range when possible.",
    "active": true,
    "version": 1
  },
  {
    "code": "RULE_015",
    "name": "Active Substrate + Hard Water Plants",
    "description": "Recommend caution when buffering substrates are used with hard-water-preferring plants.",
    "severity": "recommendation",
    "categories_involved": ["substrate", "plants"],
    "condition_logic": {
      "type": "active_substrate_hard_water_plants",
      "substrate_type_key": "type",
      "active_value": "active_buffering",
      "plant_hard_water_key": "prefers_hard_water"
    },
    "message_template": "Buffering substrates lower pH and KH. {plant_name} prefers harder, more alkaline water.",
    "fix_suggestion": "Consider an inert substrate or choose plants tolerant of softer, more acidic water.",
    "active": true,
    "version": 1
  },
  {
    "code": "RULE_016",
    "name": "Missing Heater",
    "description": "Completeness note when heater is missing (context: tropical plants).",
    "severity": "completeness",
    "categories_involved": ["heater", "plants"],
    "condition_logic": {
      "type": "missing_category",
      "category_slug": "heater",
      "requires_plants": true
    },
    "message_template": "Your build doesn't include a heater. If your room temperature drops below ~70°F, many tropical plants may slow down or decline.",
    "fix_suggestion": "Add a heater sized for your tank volume if your space isn’t consistently warm.",
    "active": true,
    "version": 1
  },
  {
    "code": "RULE_017",
    "name": "Inert Substrate + Root Feeders",
    "description": "Recommend root tabs when inert substrates are paired with heavy root feeders.",
    "severity": "recommendation",
    "categories_involved": ["substrate", "plants"],
    "condition_logic": {
      "type": "inert_substrate_root_feeders",
      "substrate_type_key": "type",
      "inert_value": "inert",
      "plant_root_feeder_key": "root_feeder"
    },
    "message_template": "Your substrate is inert, but root-feeding plants like {plant_name} get most nutrition through their roots. Plan to use root tabs.",
    "fix_suggestion": "Use root tabs consistently, or choose an active/nutrient-rich substrate for easier long-term growth.",
    "active": true,
    "version": 1
  },
  {
    "code": "RULE_018",
    "name": "Nano Tank Filter Overpowered",
    "description": "Warn when turnover is extremely high for nano tanks.",
    "severity": "warning",
    "categories_involved": ["tank", "filter"],
    "condition_logic": {
      "type": "nano_turnover_max",
      "tank_volume_key": "volume_gal",
      "filter_flow_key": "flow_rate_gph",
      "max_tank_volume_gal": 5,
      "max_turnover": 20
    },
    "message_template": "This filter may be too powerful for a nano tank. Your setup is around {turnover}× turnover, which can stress plants and livestock.",
    "fix_suggestion": "Choose a gentler filter, reduce flow, or add a spray bar to diffuse output.",
    "active": true,
    "version": 1
  },
  {
    "code": "RULE_019",
    "name": "High PAR Without CO2",
    "description": "Warn when very high light is selected without CO2 injection.",
    "severity": "warning",
    "categories_involved": ["light", "co2"],
    "condition_logic": {
      "type": "high_par_without_co2",
      "light_par_key": "par_at_substrate",
      "min_par": 100
    },
    "message_template": "This light outputs very high PAR (~{par} µmol at substrate). Without CO2 injection, you may fight algae and struggle to balance nutrients.",
    "fix_suggestion": "Add CO2, reduce intensity/photoperiod, or choose a lower-output light for low-tech setups.",
    "active": true,
    "version": 1
  },
  {
    "code": "RULE_020",
    "name": "Plant Light Conflict (Low vs High)",
    "description": "Warn when both low-light and high-light plants are mixed without a plan.",
    "severity": "warning",
    "categories_involved": ["plants", "light"],
    "condition_logic": {
      "type": "mixed_light_demand",
      "requires_low": "low",
      "requires_high": "high"
    },
    "message_template": "You’ve selected both low-light and high-light plants. This can work, but you may need to place low-light species in shade while giving high-light plants strong PAR.",
    "fix_suggestion": "Either simplify your plant list (all low-tech or all high-tech), or plan placement so low-light plants stay sheltered.",
    "active": true,
    "version": 1
  }
]
